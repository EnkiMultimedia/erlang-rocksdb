Jobs = integer_to_list(
    erlang:max(3, erlang:system_info(schedulers))
),
PreHooks = {pre_hooks, [
  {"(linux|darwin|solaris)", compile, "make -C c_src -j" ++ Jobs ++ " all"},
  {"(freebsd|openbsd)", compile, "gmake -C c_src -j" ++ Jobs ++ " all"}
  ]},
lists:keyreplace(pre_hooks, 1, CONFIG, PreHooks).