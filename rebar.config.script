J = integer_to_list(
      erlang:max(3, erlang:system_info(schedulers))
     ),
PreHooks = {pre_hooks,
            [{"(linux|darwin|solaris)", compile, "make -j" ++ J ++ " -C c_src all"},
             {"(freebsd|openbsd)", compile, "gmake -j" ++ J ++ " -C c_src all"}]},
lists:keyreplace(pre_hooks, 1, CONFIG, PreHooks).
